<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "4ace56b24e2799407b9972a7da6a7517",
  "translation_date": "2025-10-28T20:27:18+00:00",
  "source_file": "Workshop/scripts/README.md",
  "language_code": "fa"
}
-->
# اسکریپت‌های کارگاه

این پوشه شامل اسکریپت‌های خودکارسازی و پشتیبانی است که برای حفظ کیفیت و هماهنگی در مواد کارگاه استفاده می‌شوند.

## محتویات

| فایل | هدف |
|------|-----|
| `lint_markdown_cli.py` | بررسی کدهای مارک‌داون برای جلوگیری از استفاده از الگوهای دستورات منسوخ Foundry Local CLI در بلوک‌های کد. |
| `export_benchmark_markdown.py` | اجرای بنچمارک تأخیر چند مدل و تولید گزارش‌های مارک‌داون و JSON. |

## 1. بررسی الگوهای CLI مارک‌داون

`lint_markdown_cli.py` تمام فایل‌های `.md` غیر ترجمه‌ای را برای الگوهای منسوخ Foundry Local CLI **داخل بلوک‌های کد محصور** (``` ... ```) بررسی می‌کند. متن توضیحی همچنان می‌تواند دستورات منسوخ را برای زمینه تاریخی ذکر کند.

### الگوهای منسوخ (مسدود شده داخل بلوک‌های کد)

بررسی‌کننده الگوهای CLI منسوخ را مسدود می‌کند. از جایگزین‌های مدرن استفاده کنید.

### جایگزین‌های مورد نیاز
| منسوخ | به جای آن استفاده کنید |
|-------|------------------------|
| `foundry model chat <a> "..."` | `foundry model run <a> --prompt "..."` |
| `foundry model list --running` | `foundry model list` |
| `foundry model list --cached` | `foundry cache list` |
| `foundry model stats` | اسکریپت بنچمارک + ابزارهای سیستم (`Task Manager`, `nvidia-smi`) |
| `foundry model benchmark` | `samples/session03/benchmark_oss_models.py` |
| `foundry model list --available` | `foundry model list` |

### کدهای خروجی
| کد | معنی |
|----|------|
| 0 | هیچ تخلفی شناسایی نشد |
| 1 | یک یا چند الگوی منسوخ یافت شد |

### اجرای محلی
از ریشه مخزن (توصیه شده):

ویندوز (PowerShell):
```powershell
python Workshop\scripts\lint_markdown_cli.py --verbose
```

macOS / لینوکس:
```bash
python Workshop/scripts/lint_markdown_cli.py --verbose
```

### قلاب پیش‌تعهد (اختیاری)
```bash
echo "python Workshop/scripts/lint_markdown_cli.py" > .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```
این کار از تعهداتی که الگوهای منسوخ را معرفی می‌کنند جلوگیری می‌کند.

### ادغام CI
یک گردش کار GitHub Action (`.github/workflows/markdown-cli-lint.yml`) بررسی‌کننده را در هر push و pull request به شاخه‌های `main` و `Reactor` اجرا می‌کند. کارهای ناموفق باید قبل از ادغام اصلاح شوند.

### افزودن الگوهای منسوخ جدید
1. فایل `lint_markdown_cli.py` را باز کنید.
2. یک تاپل `(regex, suggestion)` به لیست `DEPRECATED` اضافه کنید. از رشته خام استفاده کنید و در صورت لزوم مرزهای کلمه `\b` را شامل کنید.
3. بررسی‌کننده را محلی اجرا کنید تا تشخیص را تأیید کنید.
4. تعهد و push کنید؛ CI قانون جدید را اجرا خواهد کرد.

مثال افزودن:
```python
DEPRECATED.append((r"\\bfoundry\\s+experimental\\s+foo\\b", "Remove experimental foo usage"))
```

### اجازه دادن به ذکر توضیحی
از آنجا که فقط بلوک‌های کد محصور اجرا می‌شوند، می‌توانید دستورات منسوخ را در متن توضیحی به‌طور ایمن توصیف کنید. اگر *باید* آنها را داخل یک بلوک نشان دهید برای تضاد، یک بلوک محصور **بدون** سه علامت بک‌تیک اضافه کنید (مثلاً با تورفتگی یا نقل قول) یا به فرم شبه بازنویسی کنید.

### رد کردن فایل‌های خاص (پیشرفته)
در صورت نیاز، مثال‌های قدیمی را در یک فایل جداگانه خارج از مخزن قرار دهید یا هنگام پیش‌نویس با پسوند دیگری تغییر نام دهید. ردهای عمدی برای نسخه‌های ترجمه شده به‌طور خودکار انجام می‌شود (مسیرهایی که شامل `translations` هستند).

### رفع اشکال
| مشکل | علت | راه‌حل |
|------|-----|-------|
| بررسی‌کننده خطی را که به‌روزرسانی کرده‌اید علامت‌گذاری می‌کند | Regex بیش از حد گسترده | الگو را با مرز کلمه اضافی (`\b`) یا لنگرها محدود کنید |
| CI شکست می‌خورد اما محلی موفق است | نسخه متفاوت Python یا تغییرات ثبت نشده | محلی دوباره اجرا کنید، مطمئن شوید که درخت کاری تمیز است، نسخه Python گردش کار را بررسی کنید (3.11) |
| نیاز به دور زدن موقت | اصلاح فوری | اصلاح را بلافاصله پس از آن اعمال کنید؛ در نظر داشته باشید از یک شاخه موقت و PR پیگیری استفاده کنید (از افزودن سوئیچ‌های دور زدن خودداری کنید) |

### دلیل
هماهنگ نگه داشتن مستندات با سطح CLI پایدار *فعلی* از اصطکاک کارگاه جلوگیری می‌کند، از سردرگمی یادگیرندگان اجتناب می‌کند و اندازه‌گیری عملکرد را از طریق اسکریپت‌های Python نگهداری شده به جای دستورات CLI پراکنده متمرکز می‌کند.

---
به عنوان بخشی از زنجیره ابزار کیفیت کارگاه نگهداری می‌شود. برای بهبودها (مانند پیشنهادات خودکار یا تولید گزارش HTML)، یک issue باز کنید یا یک PR ارسال کنید.

## 2. اسکریپت اعتبارسنجی نمونه

`validate_samples.py` تمام فایل‌های نمونه Python را برای اعتبار نحو، واردات و رعایت بهترین شیوه‌ها بررسی می‌کند.

### استفاده
```bash
# Validate all samples
python scripts/validate_samples.py

# Validate specific session
python scripts/validate_samples.py --session 01

# Verbose mode (includes best practice warnings)
python scripts/validate_samples.py --verbose

# Summary only
python scripts/validate_samples.py --summary
```

### چه چیزی را بررسی می‌کند
- ✅ اعتبار نحو Python
- ✅ واردات مورد نیاز موجود
- ✅ پیاده‌سازی مدیریت خطا (حالت توضیحی)
- ✅ استفاده از نوع‌ها (حالت توضیحی)
- ✅ توضیحات توابع (حالت توضیحی)
- ✅ لینک‌های مرجع SDK (حالت توضیحی)

### متغیرهای محیطی
- `SKIP_IMPORT_CHECK=1` - اعتبارسنجی واردات را رد کنید
- `SKIP_SYNTAX_CHECK=1` - اعتبارسنجی نحو را رد کنید

### کدهای خروجی
- `0` - تمام نمونه‌ها اعتبارسنجی را گذراندند
- `1` - یک یا چند نمونه شکست خوردند

## 3. اجرای تست نمونه

`test_samples.py` تست‌های اولیه را روی تمام نمونه‌ها اجرا می‌کند تا تأیید کند که بدون خطا اجرا می‌شوند.

### استفاده
```bash
# Test all samples
python scripts/test_samples.py

# Test specific session
python scripts/test_samples.py --session 01

# Quick mode (shorter timeouts)
python scripts/test_samples.py --quick

# Verbose mode (show output)
python scripts/test_samples.py --verbose
```

### پیش‌نیازها
- سرویس Foundry Local در حال اجرا: `foundry service start`
- مدل‌ها بارگذاری شده: `foundry model run phi-4-mini`
- وابستگی‌ها نصب شده: `pip install -r requirements.txt`

### چه چیزی را تست می‌کند
- ✅ نمونه می‌تواند بدون خطاهای زمان اجرا اجرا شود
- ✅ خروجی مورد نیاز تولید می‌شود
- ✅ مدیریت خطای مناسب در صورت شکست
- ✅ عملکرد (زمان اجرا)

### متغیرهای محیطی
- `FOUNDRY_LOCAL_ALIAS=phi-4-mini` - مدلی که برای تست استفاده می‌شود
- `TEST_TIMEOUT=30` - زمان‌بندی برای هر نمونه به ثانیه

### شکست‌های مورد انتظار
برخی تست‌ها ممکن است در صورت عدم نصب وابستگی‌های اختیاری شکست بخورند (مانند `ragas`, `sentence-transformers`). نصب کنید با:
```bash
pip install sentence-transformers ragas datasets
```

### کدهای خروجی
- `0` - تمام تست‌ها موفق بودند
- `1` - یک یا چند تست شکست خوردند

## 4. صادرکننده مارک‌داون بنچمارک

اسکریپت: `export_benchmark_markdown.py`

جدول عملکرد قابل بازتولید برای مجموعه‌ای از مدل‌ها تولید می‌کند.

### استفاده
```powershell
python Workshop\scripts\export_benchmark_markdown.py --models "qwen2.5-0.5b" --prompt "Explain retrieval augmented generation briefly." --rounds 3 --output benchmark_report.md
```

### خروجی‌ها
| فایل | توضیحات |
|------|---------|
| `benchmark_report.md` | جدول مارک‌داون (میانگین، p95، توکن‌ها/ثانیه، توکن اول اختیاری) |
| `benchmark_report.json` | آرایه معیارهای خام برای مقایسه و تاریخچه |

### گزینه‌ها
| پرچم | توضیحات | پیش‌فرض |
|------|---------|---------|
| `--models` | نام مستعار مدل‌ها به صورت جدا شده با کاما | (الزامی) |
| `--prompt` | پرامپت استفاده شده در هر دور | (الزامی) |
| `--rounds` | تعداد دورها برای هر مدل | 3 |
| `--output` | فایل خروجی مارک‌داون | `benchmark_report.md` |
| `--json` | فایل خروجی JSON | `benchmark_report.json` |
| `--fail-on-empty` | خروجی غیر صفر اگر تمام بنچمارک‌ها شکست بخورند | خاموش |

متغیر محیطی `BENCH_STREAM=1` اندازه‌گیری تأخیر توکن اول را اضافه می‌کند.

### نکات
- از `workshop_utils` برای بوت‌استرپ و کش مدل‌ها به صورت هماهنگ استفاده می‌کند.
- اگر از یک دایرکتوری کاری متفاوت اجرا شود، اسکریپت تلاش می‌کند مسیرهای جایگزین را برای یافتن `workshop_utils` پیدا کند.
- برای مقایسه GPU: یک بار اجرا کنید، شتاب‌دهی را از طریق تنظیمات CLI فعال کنید، دوباره اجرا کنید و JSON را مقایسه کنید.

---

**سلب مسئولیت**:  
این سند با استفاده از سرویس ترجمه هوش مصنوعی [Co-op Translator](https://github.com/Azure/co-op-translator) ترجمه شده است. در حالی که ما تلاش می‌کنیم دقت را حفظ کنیم، لطفاً توجه داشته باشید که ترجمه‌های خودکار ممکن است شامل خطاها یا نادرستی‌ها باشند. سند اصلی به زبان اصلی آن باید به عنوان منبع معتبر در نظر گرفته شود. برای اطلاعات حساس، ترجمه حرفه‌ای انسانی توصیه می‌شود. ما مسئولیتی در قبال سوء تفاهم‌ها یا تفسیرهای نادرست ناشی از استفاده از این ترجمه نداریم.